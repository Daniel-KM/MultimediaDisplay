<?php
/**
 * Multimedia Display BookReader Viewer
 * 
 * @copyright Copyright 2014 UCSC Library Digital Initiatives
 * @license http://www.gnu.org/licenses/gpl-3.0.txt GNU GPLv3
 * @package MultimediaDisplay
 */

/**
 * Multimedia Display BookReader Viewer class
 * 
 */
class Mmd_BookReader_Viewer extends Mmd_Abstract_Viewer
{

     /**
     * Install default profile
     *
     * Install default item types, elements, and profiles for easy setup
     *
     * @return void
     */
    public static function InstallDefaults() {
        $defaultParams = array(
            'typeName' => 'eBook',
            'typeDesc' => 'A digital representation of a bound, paged book, to be displayed using Internet Archive Book Reader. The content of this book may be stored either in Omeka or on the Internet Archive.',
            'profileName' => 'bookReaderDefault',
            'viewerName' => 'BookReader'
        );
        parent::InstallDefaults($defaultParams,$this->_paramInfo);
    }

    /**
     * Revert to default profile
     *
     * Re-install default item types, elements, and profiles
     *
     * @return void
     */
    public static function RevertDefaults() {
        $defaultProfile = get_db()->getTable('MmdProfile')->findBy(array('name'=>'BookReaderDefault'));
        $defaultProfile->delete();
        self::InstallDefaults();
    }

    /**
     * Set up parameters for this viewer
     *
     * @return void
     */
    public function setupParameters() {
        $this->_paramInfo = array(
            array(
                'name' => 'title',
                'description' => 'The title of this book, to be displayed in the BookReader header',
                'type' => 'string',
                //'value' => '',    //for enum type only
                'required' => 'false',
                'default' => ''
            ),
            array(
                'name' => 'url',
                'description' => 'The URL associated with the content of this book. If this parameter is not set, Omeka will look for the pages of the book as files attached to this item.',
                'type' => 'string',
                //'value' => '',
                'required' => 'false',
                'default' => ''
            ),
            array(
                'name' => 'width',
                'description' => 'The width in pixels of the BookReader panel through which the public views the content of this book.',
                'type' => 'int',
                //'value' => '',
                'required' => 'false',
                'default' => ''
            ),
            array(
                'name' => 'height',
                'description' => 'The height in pixels of the BookReader panel through which the public views the content of this book.',
                'type' => 'int',
                //'value' => '',
                'required' => 'false',
                'default' => ''
            )
        );

    }

    /**
     * Queue header scripts
     *
     * Queues script libraries and stylesheets to include in header
     *
     * @return null
     */
    public function head() {
        queue_js_url('http://www.archive.org/bookreader/jquery-ui-1.8.5.custom.min.js');
        queue_js_url('http://www.archive.org/bookreader/dragscrollable.js');
        queue_js_url('http://www.archive.org/bookreader/jquery.colorbox-min.js');
        queue_js_url('http://www.archive.org/bookreader/jquery.ui.ipad.js');
        queue_js_url('http://www.archive.org/bookreader/jquery.bt.min.js');
        queue_js_file('BookReader',dirname(dirname(__FILE__)).'/BookReader/');
    }

    /**
     * Retrieve body html
     *
     * Retrieves markup to include in the main content body of item show pages
     *
     * @return string Html to include in the header, 
     * linking to stylesheets and javascript libraries
     */
    public function getBodyHtml() {
        $params = array_merge($viewer_params,$item_params);
        
        ob_start();

        echo '<script type="text/javascript">';
        foreach($params as $key => $value) {
            echo 'var br_'.$key.' = '.$value.';';
        }
?>
        </script>
        <script type="text/javascript" src="<?php echo(dirname(dirname(dirname(__FILE__))).'/views/common/javascripts/BookReaderDeploy.js'); ?>" />
        <?php
        return ob_get_clean();
    }

}

?>